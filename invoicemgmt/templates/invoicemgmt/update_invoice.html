<h2 class="mb-4">Update Invoice #{{ invoice.invoice_number }}</h2>
<!-- Show form and formset errors -->
{% if form.errors %}
  <div class="alert alert-danger">
    {{ form.errors }}
  </div>
{% endif %}
{% if formset.non_form_errors %}
  <div class="alert alert-danger">
    {{ formset.non_form_errors }}
  </div>
{% endif %}
{% for f in formset %}
  {% if f.errors %}
    <div class="alert alert-danger">
      {{ f.errors }}
    </div>
  {% endif %}
{% endfor %}
<form method="post" class="mb-5">
  {% csrf_token %}
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <strong>Invoice Details</strong>
    </div>
    <div class="card-body">
      {{ form.as_p }}
    </div>
  </div>

  <div class="card">
    <div class="card-header bg-secondary text-white">
      <strong>Invoice Line Items</strong>
    </div>
    <div class="card-body">
      {{ formset.management_form }}
      <table class="table table-bordered table-striped">
        <thead>
          <tr>
            <th>Product</th>
            <th>Description</th>
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>VAT Rate</th>
            <th>Discount</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody>
          {% for item_form in formset %}
            <tr>
              {{ item_form.id }} <!-- Add this line to include the hidden id field -->
              <td>{{ item_form.product }}</td>
              <td>{{ item_form.description }}</td>
              <td>{{ item_form.quantity }}</td>
              <td>{{ item_form.unit_price }}</td>
              <td>{{ item_form.vat_rate }}</td>
              <td>{{ item_form.is_discount }}</td>
              <td>
                {% if item_form.instance.pk %}
                  {{ item_form.DELETE }}
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <button type="submit" class="btn btn-success mt-4">Update Invoice</button>
  <a href="{% url 'invoice_list' %}" class="btn btn-secondary mt-4">Cancel</a>
</form>